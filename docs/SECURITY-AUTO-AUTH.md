# ClaudeFlow 自動認証システム

ClaudeFlowには、開発プロセスを自動化するための自動認証システムが組み込まれています。

## 概要

自動認証システムは、ClaudeFlow実行時に必要な認証情報（パスワード、APIキー、JWTシークレットなど）を自動生成し、安全に記録するシステムです。

## 主な機能

### 1. 自動認証情報生成
- **ランダムパスワード**: 指定した長さの安全なパスワードを生成
- **JWTシークレット**: JWT認証用の高度に安全なシークレットキーを生成
- **データベースパスワード**: データベース接続用のパスワードを生成
- **APIキー**: API認証用のキーを生成

### 2. 自動検出と記録
ClaudeFlowは生成されたコード内で以下のパターンを自動検出し、適切な認証情報を生成・記録します：

- `JWT_SECRET`, `jwtSecret`, `JWT_KEY`
- `DATABASE_URL`, `DB_PASSWORD`, `database.*password`
- `API_KEY`, `apiKey`, `API_SECRET`
- `admin.*password`, `default.*password`, `initial.*password`

### 3. セキュリティログ
すべての生成された認証情報は`security/generated_credentials.md`に記録されます：

```markdown
## 実装フェーズ - JWT Secret
**生成日時:** 2024-07-14 15:30:45
**説明:** JWT認証用シークレットキー
**値:** `AbCdEf123456...`
```

## 使用方法

### 基本的な使用方法

ClaudeFlowのパイプライン実行時、自動認証システムは透明に動作します：

```bash
cd ClaudeFlow/scripts
./run-pipeline.sh
```

### セキュリティ管理ツール

専用の管理スクリプトを使用して、認証情報を個別に管理できます：

```bash
# 環境変数ファイル生成
./manage-security.sh generate-env MyApp

# パスワード生成
./manage-security.sh generate-password 20

# JWTシークレット生成
./manage-security.sh generate-jwt

# 保存された認証情報を表示
./manage-security.sh show-credentials

# 自動認証の有効化/無効化
./manage-security.sh enable-auto-auth
./manage-security.sh disable-auto-auth

# 認証情報のバックアップ
./manage-security.sh backup-credentials

# 認証情報のクリア
./manage-security.sh clear-credentials
```

### 環境変数ファイル自動生成

```bash
./manage-security.sh generate-env MyProject
```

生成される`.env.example`の例：

```env
# MyProject Environment Variables
# Generated by ClaudeFlow on 2024-07-14 15:30:45

# Database
DATABASE_URL="postgresql://username:XyZ789AbC123@localhost:5432/dbname"
DB_PASSWORD="AbC123XyZ789"

# JWT Authentication
JWT_SECRET="MTIzNDU2Nzg5MGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6"
JWT_EXPIRES_IN="7d"

# API Configuration
API_KEY="A1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6"
API_SECRET="P6O5N4M3L2K1J0I9H8G7F6E5D4C3B2A1"

# Admin User
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="SecurePass123!"

# Security
BCRYPT_ROUNDS=12
SESSION_SECRET="RandomSessionSecretKey123456789..."

# Development
NODE_ENV="development"
PORT=3000
```

## セキュリティ設定

### 自動認証の有効化/無効化

```bash
# 有効化（デフォルト）
./manage-security.sh enable-auto-auth

# 無効化
./manage-security.sh disable-auto-auth
```

### 認証情報のバックアップ・復元

```bash
# バックアップ作成
./manage-security.sh backup-credentials

# 特定ファイルにバックアップ
./manage-security.sh backup-credentials /path/to/backup.md

# バックアップから復元
./manage-security.sh restore-credentials /path/to/backup.md
```

## セキュリティ考慮事項

### ⚠️ 重要な注意事項

1. **本番環境での使用**
   - 生成された認証情報は開発用です
   - 本番環境では必ず独自の安全な値に変更してください

2. **ファイル管理**
   - `security/generated_credentials.md`は機密情報を含みます
   - バージョン管理システムにコミットしないでください
   - 適切なアクセス権限を設定してください

3. **バックアップ**
   - 定期的にバックアップを作成してください
   - バックアップファイルも安全に保管してください

### 推奨セキュリティ設定

```bash
# セキュリティディレクトリの権限設定
chmod 700 ClaudeFlow/security/
chmod 600 ClaudeFlow/security/*.md

# .gitignoreに追加
echo "security/" >> .gitignore
echo ".env" >> .gitignore
echo ".env.local" >> .gitignore
```

## トラブルシューティング

### よくある問題

1. **認証情報が生成されない**
   ```bash
   # 自動認証が有効か確認
   ./manage-security.sh show-credentials
   
   # 手動で認証情報を生成
   ./manage-security.sh generate-password
   ```

2. **権限エラー**
   ```bash
   # スクリプトに実行権限を付与
   chmod +x ./manage-security.sh
   ```

3. **ファイルが見つからない**
   ```bash
   # セキュリティディレクトリを初期化
   mkdir -p security/
   ./manage-security.sh generate-env
   ```

## 設定ファイル

ClaudeFlowの設定は`.claudeflow_config`で管理されます：

```bash
# 自動認証設定
AUTO_APPROVE_ENABLED=true

# セキュリティログファイルパス
SECURITY_LOG_FILE="./security/generated_credentials.md"
```

## ログとモニタリング

### セキュリティサマリー表示

ClaudeFlow実行完了時、セキュリティサマリーが表示されます：

```
=== セキュリティサマリー ===
生成された認証情報: 5
詳細は以下を参照:
./security/generated_credentials.md
========================
```

### ログファイルの構造

```markdown
# 自動生成認証情報

**⚠️ セキュリティ警告 ⚠️**
- このファイルには機密情報が含まれています
- 本番環境では必ず安全な場所に保管してください
- バージョン管理システムにコミットしないでください

## 生成日時
2024-07-14 15:30:45

## 実装フェーズ - JWT Secret
**生成日時:** 2024-07-14 15:30:45
**説明:** JWT認証用シークレットキー
**値:** `MTIzNDU2Nzg5MGFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6`

## 実装フェーズ - Database Password
**生成日時:** 2024-07-14 15:30:46
**説明:** データベース接続用パスワード
**値:** `AbC123XyZ789DefGhi456Jkl`
```

## 関連ドキュメント

- [DEVELOPMENT-FLOW.md](./DEVELOPMENT-FLOW.md) - 開発フロー全体の説明
- [USAGE-JP.md](./USAGE-JP.md) - ClaudeFlowの使用方法
- [AUTO-INCREMENTAL-IMPLEMENTATION.md](./AUTO-INCREMENTAL-IMPLEMENTATION.md) - 自動実装機能
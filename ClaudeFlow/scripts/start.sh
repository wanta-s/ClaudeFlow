#!/bin/bash

# çµ±åˆã‚¹ã‚¿ãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‹è©³ç´°è¨­å®šã‹ã‚’é¸æŠžå¯èƒ½

set -e

# ã‚«ãƒ©ãƒ¼å®šç¾©
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[0;33m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# å…±é€šé–¢æ•°ã‚’èª­ã¿è¾¼ã‚€
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/common-functions.sh"

# ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
clear
echo -e "${CYAN}================================================${NC}"
echo -e "${CYAN}       AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰        ${NC}"
echo -e "${CYAN}================================================${NC}"
echo ""
echo -e "${BLUE}ã‚¢ã‚¤ãƒ‡ã‚¢ã‹ã‚‰å‹•ããƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¾ã§ã€AIãŒè‡ªå‹•ã§é–‹ç™ºã—ã¾ã™ã€‚${NC}"
echo ""

# æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¢ºèª
if [ -f "$PROJECT_ROOT/.current_project" ] || [ -f "$PROJECT_ROOT/ClaudeFlow/implementation/features.json" ]; then
    echo -e "${YELLOW}âš ï¸  å‰ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ${NC}"
    echo ""
    echo -n "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€æ—¢å­˜ã®è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ (y/N): "
    read -r clear_choice
    if [[ "$clear_choice" =~ ^[Yy]$ ]]; then
        echo ""
        echo -n "æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: "
        read -r new_project_name
        clear_project_state "${new_project_name:-new_project}"
        echo ""
    fi
fi

echo -e "${GREEN}ã©ã¡ã‚‰ã®ãƒ¢ãƒ¼ãƒ‰ã§å§‹ã‚ã¾ã™ã‹ï¼Ÿ${NC}"
echo ""
echo -e "${CYAN}ðŸš€ 1) è¶…è»½é‡ãƒ¢ãƒ¼ãƒ‰${NC} - ã‚¢ãƒ—ãƒªåã ã‘ã§5åˆ†å®Œæˆ"
echo "   â”” ã‚ªã‚»ãƒ­ã‚²ãƒ¼ãƒ ç­‰ã®ç°¡å˜ãªã‚¢ãƒ—ãƒªå‘ã‘ï¼ˆ3ãƒ•ã‚§ãƒ¼ã‚ºï¼‰"
echo -e "${BLUE}   ðŸŽ¯ CodeFit Design: 800è¡Œåˆ¶é™ã§ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå®Ÿè£…${NC}"
echo ""
echo -e "${YELLOW}2) ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ${NC} - ã‚¢ãƒ—ãƒªåã ã‘å…¥åŠ›ï¼ˆ30ç§’ã§é–‹å§‹ï¼‰"
echo "   â”” æœ€é€Ÿã§ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½œæˆã—ãŸã„æ–¹å‘ã‘"
echo -e "${BLUE}   ðŸŽ¯ CodeFit Design: 1500è¡Œåˆ¶é™ã§è»½é‡å®Ÿè£…${NC}"
echo ""
echo -e "${BLUE}3) è©³ç´°è¨­å®š${NC} - è³ªå•ã«ç­”ãˆã¦ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºï¼ˆ3-5åˆ†ï¼‰"
echo "   â”” è¦ä»¶ã‚’ç´°ã‹ãæŒ‡å®šã—ãŸã„æ–¹å‘ã‘"
echo -e "${BLUE}   ðŸŽ¯ CodeFit Design: 2000è¡Œåˆ¶é™ã§æ¨™æº–å®Ÿè£…${NC}"
echo ""
echo -e "${GREEN}4) ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆ${NC} - è³ªå•ãªã—ã§å³é–‹å§‹ï¼ˆ10ç§’ï¼‰"
echo "   â”” ã¨ã«ã‹ãä»Šã™ãå‹•ãã‚‚ã®ãŒæ¬²ã—ã„æ–¹å‘ã‘"
echo -e "${BLUE}   ðŸŽ¯ CodeFit Design: 2000è¡Œåˆ¶é™ã§æ¨™æº–å®Ÿè£…${NC}"
echo ""
echo -n "é¸æŠžã—ã¦ãã ã•ã„ (1-4): "
read mode_choice

case $mode_choice in
    1)
        echo ""
        echo -e "${CYAN}ðŸš€ è¶…è»½é‡ãƒ¢ãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¾ã™...${NC}"
        sleep 1
        "$(dirname "$0")/ultra-light.sh"
        ;;
    2)
        echo ""
        echo -e "${YELLOW}ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¾ã™...${NC}"
        sleep 1
        "$(dirname "$0")/quick-start.sh"
        ;;
    3)
        echo ""
        echo -e "${BLUE}è©³ç´°è¨­å®šãƒ¢ãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¾ã™...${NC}"
        sleep 1
        "$(dirname "$0")/interactive-planning.sh"
        ;;
    4)
        echo ""
        echo -e "${BLUE}ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã§é–‹ç™ºã‚’é–‹å§‹ã—ã¾ã™...${NC}"
        
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’é©ç”¨
        apply_preset "rapid"
        
        # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        OUTPUT_DIR="$(dirname "$0")/../results"
        mkdir -p "$OUTPUT_DIR"
        OUTPUT_FILE="$OUTPUT_DIR/00_user_input.md"
        
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        cat > "$OUTPUT_FILE" << EOF
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¼ç”»æ›¸ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ï¼‰

## åŸºæœ¬æƒ…å ±
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å**: AIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **æ¦‚è¦**: æ¥­å‹™åŠ¹çŽ‡åŒ–ã‚’ç›®çš„ã¨ã—ãŸæ±Žç”¨çš„ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- **æƒ³å®šãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä¸€èˆ¬çš„ãªãƒ“ã‚¸ãƒã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **æƒ³å®šåˆ©ç”¨è€…æ•°**: 100äººç¨‹åº¦

## æ©Ÿèƒ½è¦ä»¶
### å¿…é ˆæ©Ÿèƒ½
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€æ¤œç´¢æ©Ÿèƒ½

### è¿½åŠ æ©Ÿèƒ½
ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼, æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½, ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

## ä½¿ç”¨ç’°å¢ƒ
- **ãƒ‡ãƒã‚¤ã‚¹**: ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹
- **ä½¿ç”¨é »åº¦**: æ¯Žæ—¥

## ãƒ‡ã‚¶ã‚¤ãƒ³è¦ä»¶
- **å„ªå…ˆåº¦**: ã‚·ãƒ³ãƒ—ãƒ«ã§ä½¿ã„ã‚„ã™ã‘ã‚Œã°è‰¯ã„
- **å‚è€ƒ**: ãªã—

## éžæ©Ÿèƒ½è¦ä»¶
- **ãƒ‡ãƒ¼ã‚¿æ©Ÿå¯†æ€§**: ç¤¾å†…æƒ…å ±ï¼ˆä¸­ç¨‹åº¦ï¼‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹**: é€šå¸¸ã®é€Ÿåº¦ã§å•é¡Œãªã„

---
*ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ•ãƒ«ã‚ªãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚*
EOF
        
        # ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œ
        echo ""
        echo -e "${GREEN}ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©åŒ–ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’ç”Ÿæˆä¸­...${NC}"
        "$(dirname "$0")/generate-tasks.sh" "$OUTPUT_FILE"
        
        echo ""
        echo -e "${GREEN}é–‹ç™ºã‚’é–‹å§‹ã—ã¾ã™ï¼${NC}"
        sleep 2
        "$(dirname "$0")/run-pipeline.sh" "$OUTPUT_FILE"
        ;;
    *)
        echo ""
        echo -e "${YELLOW}ç„¡åŠ¹ãªé¸æŠžã§ã™ã€‚ã‚‚ã†ä¸€åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚${NC}"
        exit 1
        ;;
esac